<div class="container mx-auto px-4 py-8 min-h-[60vh]">
  <h1 class="text-3xl font-bold text-gray-800 mb-8 border-b pb-4">My Wishlist</h1>

  @if (isLoading()) {
    <div class="flex justify-center items-center h-64">
      <i class="fas fa-spinner fa-spin text-4xl text-green-600"></i>
    </div>
  } @else if (wishlistProducts().length === 0) {
    <div class="flex flex-col items-center justify-center text-center py-12 bg-gray-50 rounded-lg shadow-sm">
      <div class="bg-gray-100 p-6 rounded-full mb-4">
        <i class="far fa-heart text-6xl text-gray-400"></i>
      </div>
      <h2 class="text-2xl font-semibold text-gray-700 mb-2">
        Your wishlist is empty!
      </h2>
      <p class="text-gray-500 mb-6 max-w-md">
        Explore more and shortlist some items to buy later.
      </p>
      <a
        routerLink="/products"
        class="bg-green-600 text-white px-8 py-3 rounded-full hover:bg-green-700 transition shadow-lg hover:shadow-xl transform hover:-translate-y-1"
      >
        Browse Products
      </a>
    </div>
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      @for (product of wishlistProducts(); track product.id) {
        <div class="relative group bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300">
          
          <!-- Remove Button -->
          <button
            (click)="removeFromWishlist(product.id)"
            class="absolute top-3 right-3 z-20 bg-white/90 text-red-500 hover:bg-red-500 hover:text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md transition-colors"
            title="Remove from Wishlist"
          >
            <i class="fas fa-times"></i>
          </button>

          <!-- Image Area -->
          <div class="relative h-64 overflow-hidden bg-gray-100">
            <img
              [routerLink]="['/details', product.slug, product.id]"
              [src]="product.imageCover"
              [alt]="product.title"
              class="w-full h-full object-contain p-4 group-hover:scale-110 transition-transform duration-500 cursor-pointer"
            />
            
            <!-- Move to Cart Button (Overlay) -->
            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
              <button
                (click)="moveToCart(product.id)"
                class="bg-white text-gray-900 font-semibold px-6 py-2 rounded-full transform translate-y-4 group-hover:translate-y-0 transition-all duration-300 shadow-lg hover:bg-green-500 hover:text-white flex items-center gap-2"
              >
                <i class="fas fa-cart-plus"></i> Move to Cart
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="p-4">
            <div class="text-xs text-indigo-500 uppercase font-bold tracking-wide mb-1">
              {{ product.category.name }}
            </div>
            
            <h3
              [routerLink]="['/details', product.slug, product.id]"
              class="text-lg font-semibold text-gray-800 truncate mb-2 cursor-pointer hover:text-green-600 transition-colors"
              title="{{ product.title }}"
            >
              {{ product.title }}
            </h3>

            <div class="flex items-center justify-between mb-4">
              <div class="flex flex-col">
                @if (product.priceAfterDiscount) {
                   <span class="text-sm text-gray-400 line-through">{{ product.price | currency:'EGP ' }}</span>
                   <span class="text-xl font-bold text-gray-900">{{ product.priceAfterDiscount | currency:'EGP ' }}</span>
                } @else {
                   <span class="text-xl font-bold text-gray-900">{{ product.price | currency:'EGP ' }}</span>
                }
              </div>
              <div class="flex items-center gap-1 text-yellow-500 text-sm bg-yellow-50 px-2 py-1 rounded">
                <i class="fas fa-star"></i>
                <span class="font-medium text-gray-700">{{ product.ratingsAverage }}</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="grid grid-cols-2 gap-2 mt-auto">
               <button 
                  [routerLink]="['/details', product.slug, product.id]"
                  class="border border-gray-300 text-gray-600 hover:bg-gray-50 hover:text-gray-900 py-2 rounded-lg text-sm font-medium transition-colors"
                >
                  View Details
               </button>
               <button 
                  (click)="addToCart(product.id)"
                  class="bg-green-600 text-white hover:bg-green-700 py-2 rounded-lg text-sm font-medium transition-colors shadow-md hover:shadow-lg"
               >
                  Add to Cart
               </button>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
